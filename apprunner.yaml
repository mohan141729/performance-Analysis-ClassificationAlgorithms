version: 1.0
resources:
  - name: performance-analysis-service
    type: "AWS::AppRunner::Service"
    properties:
      sourceConfiguration:
        imageRepository:
          imageIdentifier: "<aws_account_id>.dkr.ecr.<your-region>.amazonaws.com/performance-analysis-repo:latest"
          imageConfiguration:
            port: "8000"
        autoDeploymentsEnabled: true
        authenticationConfiguration:
          connectionArn: arn:aws:secretsmanager:<your-region>:<aws_account_id>:secret:your-secrets-manager-connection
        environmentVariables:
          - name: FLASK_APP
            value: "app.py"
          - name: FLASK_ENV
            value: "production"
          - name: APP_PORT
            value: "8000"
      instanceConfiguration:
        cpu: 1024
        memory: 2048
        environmentVariables:
          - name: AWS_REGION
            value: "<your-region>"
            # Include other necessary environment variables if required
        scalingConfiguration:
          minSize: 1
          maxSize: 2

      healthCheckConfiguration:
        path: "/"
        intervalSeconds: 30
        timeoutSeconds: 5
        healthyThreshold: 3
        unhealthyThreshold: 3

      serviceRole: arn:aws:iam::<aws_account_id>:role/AppRunnerServiceRole

# Optionally, you can specify logs and other configurations.
logging:
  logGroup: "/aws/apprunner/performance-analysis-service"
  logStreamPrefix: "logs"
